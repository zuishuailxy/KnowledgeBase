# 生命周期

## Vue 3 生命周期（Composition API 写法）

Vue 3 使用 setup() + 组合式 API，常见生命周期钩子如下：

| 生命周期钩子              | 执行时机            | 常见用途                |
| ------------------- | --------------- | ------------------- |
| `onBeforeMount`     | 组件挂载到 DOM 之前    | 初始化逻辑（此时 DOM 还未生成）  |
| `onMounted`         | 组件挂载完成，DOM 已经生成 | 操作 DOM、发起请求、注册监听器   |
| `onBeforeUpdate`    | 响应式数据变更，DOM 更新前 | 在更新前读取旧的 DOM 状态     |
| `onUpdated`         | DOM 更新完成        | 操作更新后的 DOM、调试 UI    |
| `onBeforeUnmount`   | 组件卸载前           | 清理定时器、取消订阅、解绑事件     |
| `onUnmounted`       | 组件卸载后           | 最后的清理工作，避免内存泄漏      |
| `onErrorCaptured`   | 捕获子组件错误时触发      | 做错误处理或日志上报          |
| `onRenderTracked`   | 组件渲染时追踪依赖       | 调试用（追踪 reactive 依赖） |
| `onRenderTriggered` | 响应式依赖触发渲染时      | 调试用（知道是谁触发了更新）      |

Vue 3 示例代码

```vue
<script setup>
import { 
  onBeforeMount, onMounted, 
  onBeforeUpdate, onUpdated, 
  onBeforeUnmount, onUnmounted 
} from 'vue'

onBeforeMount(() => {
  console.log('组件挂载前')
})

onMounted(() => {
  console.log('组件已挂载')
  // 比如发起网络请求 / 使用 DOM API
})

onBeforeUpdate(() => {
  console.log('组件更新前')
})

onUpdated(() => {
  console.log('组件更新完成')
})

onBeforeUnmount(() => {
  console.log('组件卸载前')
  // 清理定时器 / 移除事件监听
})

onUnmounted(() => {
  console.log('组件卸载完成')
})
</script>

<template>
  <div>生命周期 Demo</div>
</template>
```

## Vue 2 和 Vue 3 的对比

| Vue 2           | Vue 3 对应                       |
| --------------- | ------------------------------ |
| `beforeCreate`  | **被 setup 取代**（不再单独暴露）         |
| `created`       | **被 setup 取代**（数据/方法定义在 setup） |
| `beforeMount`   | `onBeforeMount`                |
| `mounted`       | `onMounted`                    |
| `beforeUpdate`  | `onBeforeUpdate`               |
| `updated`       | `onUpdated`                    |
| `beforeDestroy` | `onBeforeUnmount`              |
| `destroyed`     | `onUnmounted`                  |

## 常见问题 & 建议

请求数据放哪里？
一般放在 onMounted（确保 DOM 已生成，SSR 也能兼容）。

事件监听 / 定时器？
在 onMounted 注册，在 onUnmounted 清理。

调试依赖更新？
可以用 onRenderTracked 和 onRenderTriggered 来定位性能瓶颈。
